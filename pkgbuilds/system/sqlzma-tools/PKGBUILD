# Contributor: Jens Pranaitis <jens@chaox.net>
# Contributor: Aaron Griffin <aaron@archlinux.org>
# Original TU: Jeff Mickey <j@codemac.net>
# Contributor: ciccio.a
pkgname=sqlzma-tools
pkgver=4.0
pkgrel=2
pkgdesc="Tools for squashfs, a highly compressed read-only filesystem for Linux, with lzma patches."
url="http://squashfs.sourceforge.net"
license=("GPL")
arch=('i686' 'x86_64')
depends=('zlib' 'glibc')
source=(http://downloads.sourceforge.net/sourceforge/squashfs/squashfs$pkgver.tar.gz
        sqlzma-from-openwrt.patch
        http://dl.sourceforge.net/sourceforge/sevenzip/lzma465.tar.bz2
        Makefile
        )
md5sums=('a3c23391da4ebab0ac4a75021ddabf96'
         '43a496df12bb815d436c2b8455f93ef0'
         '29d5ffd03a5a3e51aef6a74e9eafb759'
         'c7366db4df9ef1cc587929c8509c175c')
build()
{
    cd "${srcdir}"/
    cp "${srcdir}"/Makefile "${srcdir}"/C/LzmaLib/
    make -C C/LzmaLib -f Makefile
    cd "${srcdir}"/squashfs$pkgver/squashfs-tools || return 1
    patch -Np2 -i "${srcdir}"/sqlzma-from-openwrt.patch || return 1
    sed -i "s|LZMA_CFLAGS =.*|LZMA_CFLAGS = -DUSE_LZMA -I../../C|" Makefile
    sed -i "s|LZMA_LIB =.*|LZMA_LIB="${srcdir}"/C/LzmaLib/liblzma.a|" Makefile
    USE_LZMA=1 make || return 1
    mkdir -p $startdir/pkg/sbin
    cp -a mksquashfs unsquashfs $startdir/pkg/sbin
}
